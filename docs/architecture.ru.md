# architecture

[English](architecture.md) | [Русский](architecture.ru.md)

## Основные детали

### На что нужно обращать внимание при проектировании 

При проектировании файлового брокера сообщений стоит обратить внимание на:
- Безопасность доступа к директории и файлам.
- Обработку ошибок при чтении/записи файлов.
- Механизмы синхронизации доступа к файлам, чтобы избежать конфликтов при одновременной записи/чтении.
- Оптимизацию процесса записи и чтения сообщений для обеспечения высокой производительности.

### Основные компоненты файлового брокера сообщений

Основные компоненты брокера сообщений, который сохраняет очередь сообщений в директорию, могут включать:
- Класс для работы с директорией и файлами.
- Механизмы для добавления сообщений в очередь и извлечения сообщений из очереди.
- Методы для сохранения запросов и ответов в файлах согласно требованиям.
- Логика для расчета ключа для сохранения файла по формуле MD5.

### Структурирование и именование директорий

Для структурирования и именования директорий можно использовать подход, где каждый запрос и соответствующий ответ хранятся в отдельной директории с уникальным идентификатором (например, по временной метке).

### Концепты для высокопроизводительного файлового брокера

Концепты для высокопроизводительного файлового брокера:
- Оптимизация работы с файловой системой
- Пул потоков для эффективного управления потоками
- Использование кэширования для быстрого доступа к данным
- Оптимизация алгоритмов обработки сообщений
- Механизмы мониторинга и управления нагрузкой
- Распределенная архитектура для горизонтального масштабирования
- Использование высокопроизводительных структур данных
- Оптимизация сетевого взаимодействия
- Обработка ошибок и восстановление после сбоев
- Тестирование и профилирование производительности

### Механизмы обеспечения отказоустойчивости 

Для предотвращения потери сообщений при падении сервиса, можно использовать механизмы персистентности, например, сохранять сообщения на диск перед отправкой на брокер сообщений или использовать очереди сообщений с поддержкой гарантированной доставки.
